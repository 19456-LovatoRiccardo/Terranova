<html>
    <style>
        table,th,td {
            border : 1px solid black;
            border-collapse: collapse;
        }
        th,td {
            padding: 5px;
        }
    </style>
    
    <head>
        <title>Terranova Debug Test</title>
    </head>

    <body>
        <h2>Terranova Debug Test</h1>

        <label for="indirizzo">Indirizzo IP:</label>
        <input value="localhost" id="indirizzo">
        <label for="porta">Numero di Porta:</label>
        <input value="9091" id="porta">
        <button type="button"
                onclick="checkConnection()">
            Controlla Connessione
        </button>
        <output id="connectionResult"></output>

        <p></p>
        
        <button type="button"
                onclick="getAllAccounts()">
            Get All Accounts
        </button>
        <table id="allAccountsResult"></table>

        <p></p>

        <p>Login</p>
        <input placeholder="email" id="loginEmail">
        <input placeholder="password" id="loginPassword">
        <button type="button"
                onclick="login()">
            Login
        </button>
        <output id="loginResult"></output>

        <p></p>

        <p>Register</p>
        <input placeholder="email" id="registerEmail">
        <input placeholder="password" id="registerPassword">
        <input placeholder="cognome" id="registerCognome">
        <input placeholder="nome" id="registerNome">
        <br>
        <input type="number" placeholder="numero civico" id="registerNumCivico">
        <input type="number" placeholder="cap" id="registerCap">
        <input placeholder="ragione sociale" id="registerRagSociale">
        <br>
        <input value="codice fiscale" id="registerCodiceFiscale">
        <input value="indirizzo" id="registerIndirizzo">
        <input value="localitÃ " id="registerLocalita">
        <br>
        <input value="provincia" id="registerProvincia">
        <input value="nazione" id="registerNazione">
        <input value="numero telefonico" id="registerNumTelefonico">
        <button type="button"
                onclick="register()">
            Register
        </button>
        <output id="registerResult"></output>

        <p></p>

        <p>Richiedi Anagrafica</p>
        <input placeholder="token" id="anagraficaToken">
        <button type="button"
                onclick="richiediAnagrafica()">
            Richiedi
        </button>
        <output id="anagraficaResult"></output>

        <p></p>
        
        <button type="button"
                onclick="getAllAnagrafiche()">
            Get All Anagrafiche
        </button>
        <table id="allAnagraficheResult"></table>
        
        <p></p>
        
        <button type="button"
                onclick="getAllContratti()">
            Get All Anagrafiche
        </button>
        <table id="allContrattiResult"></table>
        
        <script>
            function getIndirizzo() {
                let indirizzoIp = document.getElementById("indirizzo").value
                let numPorta = document.getElementById("porta").value
                return  "http://" + indirizzoIp + ":" + numPorta + "/api/"
            }
            function preparaRichiesta(xhttp, callback) {
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        callback(this)
                    }
                }
                return xhttp
            }

            function checkConnection() {
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, checkConnectionResult)
                xhttp.open("GET", getIndirizzo()+"debug/checkConnection", true)
                xhttp.send()
                document.getElementById("connectionResult").innerHTML = "Connessione Fallita."
            }
            function checkConnectionResult(xhttp) {
                document.getElementById("connectionResult").innerHTML = "Connessione Riuscita!"
            }

            function getAllAccounts() {
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, allAccountsResult)
                xhttp.open("GET", getIndirizzo()+"debug/account/all", true)
                xhttp.send()
            }
            function allAccountsResult(xhttp) {
                var accounts = JSON.parse(xhttp.responseText)
                var table = ""
                table += "<tr>"
                table += "<th>Email</th>"
                table += "<th>Password</th>"
                table += "</tr>"
                for (var i=0; i < accounts.length; i++) {
                    table += "<tr>"
                    table += "<td>" + accounts[i]["email"] + "</td>"
                    table += "<td>" + accounts[i]["password"] + "</td>"
                    table += "</tr>"
                }
                document.getElementById("allAccountsResult").innerHTML = table
            }

            function register() {
                let email = document.getElementById("registerEmail").value
                let password = document.getElementById("registerPassword").value
                let cognome = document.getElementById("registerCognome").value
                let nome = document.getElementById("registerNome").value
                let ragSociale = document.getElementById("registerRagSociale").value
                let codiceFiscale = document.getElementById("registerCodiceFiscale").value
                let indirizzo = document.getElementById("registerIndirizzo").value
                let numCivico = document.getElementById("registerNumCivico").value
                let cap = document.getElementById("registerCap").value
                let localita = document.getElementById("registerLocalita").value
                let provincia = document.getElementById("registerProvincia").value
                let nazione = document.getElementById("registerNazione").value
                let numTelefonico = document.getElementById("registerNumTelefonico").value
                let body = {"email": email, "password": password, "cognome": cognome, "nome": nome,
                            "ragSociale": ragSociale, "codiceFiscale": codiceFiscale, "indirizzo": indirizzo,
                            "numCivico": numCivico, "cap": cap, "localita": localita, "provincia": provincia,
                            "nazione": nazione, "numTelefonico": numTelefonico}

                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, registerResult)
                xhttp.open("POST", getIndirizzo()+"auth/register", true)
                xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                xhttp.send(JSON.stringify(body))
            }
            function registerResult(xhttp) {
                let token = JSON.parse(xhttp.responseText).token
                document.getElementById("registerResult").innerHTML = "Token: " + token
            }

            function login() {
                let email = document.getElementById("loginEmail").value
                let password = document.getElementById("loginPassword").value
                let body = {"email": email, "password": password}
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, loginResult)
                xhttp.open("POST", getIndirizzo()+"auth/authenticate", true)
                xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                xhttp.send(JSON.stringify(body))
            }
            function loginResult(xhttp) {
                let token = JSON.parse(xhttp.responseText).token
                document.getElementById("loginResult").innerHTML = "Token: " + token
            }

            function richiediAnagrafica() {
                let token = document.getElementById("anagraficaToken").value
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, richiediAnagraficaResult)
                xhttp.open("GET", getIndirizzo()+"privateArea/anagrafica", true)
                xhttp.setRequestHeader('Authorization','Bearer ' + token)
                xhttp.send()
            }
            function richiediAnagraficaResult(xhttp) {
                document.getElementById("anagraficaResult").innerHTML = xhttp.responseText
            }

            function getAllAnagrafiche() {
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, allAnagraficheResult)
                xhttp.open("GET", getIndirizzo()+"debug/anagrafica/all", true)
                xhttp.send()
            }
            function allAnagraficheResult(xhttp) {
                var anagrafiche = JSON.parse(xhttp.responseText)
                var table = ""
                table += "<tr>"
                table += "<th>ID</th>"
                table += "<th>Ragione Sociale</th>"
                table += "</tr>"
                for (var i=0; i < anagrafiche.length; i++) {
                    table += "<tr>"
                    table += "<td>" + anagrafiche[i]["id"] + "</td>"
                    table += "<td>" + anagrafiche[i]["ragSociale"] + "</td>"
                    table += "</tr>"
                }
                document.getElementById("allAnagraficheResult").innerHTML = table
            }
            
            function getAllContratti() {
                let xhttp = new XMLHttpRequest()
                preparaRichiesta(xhttp, allContrattiResult)
                xhttp.open("GET", getIndirizzo()+"debug/contratto/all", true)
                xhttp.send()
            }
            function allContrattiResult(xhttp) {
                var contratti = JSON.parse(xhttp.responseText)
                var table = ""
                table += "<tr>"
                table += "<th>ID</th>"
                table += "<thDescrizione Offerta</th>"
                table += "</tr>"
                for (var i=0; i < contratti.length; i++) {
                    table += "<tr>"
                    table += "<td>" + contratti[i]["id"] + "</td>"
                    table += "<td>" + contratti[i]["descrizioneOfferta"] + "</td>"
                    table += "</tr>"
                }
                document.getElementById("allContrattiResult").innerHTML = table
            }
        </script>
    </body>
</html> 
